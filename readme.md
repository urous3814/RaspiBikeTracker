# RaspiBikeTracker

이 프로젝트는 모바일스마트시스템 수업에서 사용할 미니프로젝트로, 라즈베리파이, 윈도우, 웹을 이용하여 자전거 추적 및 경고 시스템을 구현합니다. 이 시스템은 다음과 같은 기능들을 제공합니다:

## 기능

1. **자전거 추적**
   - 핸드폰의 가속도센서와 GPS 데이터를 MQTT를 통해 전송하여 자전거의 위치와 속도를 추적합니다.

2. **조도센서**
   - 조도센서를 이용하여 자전거가 터널 안에 있는지 밖에 있는지 여부를 감지합니다.
   - 만약 터널 안에 있다면 시야확보를 위해 전후면 LED를 켜줍니다.

3. **초음파센서**
   - 초음파센서를 이용하여 충돌 위험을 감지하고 경고합니다.

4. **온습도센서**
   - 온습도센서를 이용하여 강수확률을 계산하고, 비가 올 것 같으면 LED로 경고합니다.

5. **카메라**
   - 카메라를 이용하여 운동 중 마주친 자전거 수를 기록합니다.
   - 자전거가 도로를 벗어나는 경우 경고를 제공합니다.

6. **버튼**
   - 버튼을 이용하여 휴식 모드로 전환할 수 있습니다.

7. **플라스크 웹서버**
   - 플라스크 웹서버를 통해 통계와 운동 기록 등을 볼 수 있습니다.

## 시스템 구성

### 하드웨어
- 라즈베리파이
- 조도센서
- 초음파센서
- 온습도센서
- 카메라 모듈
- LED
- 버튼
- GPIO Extender

### 소프트웨어
- 라즈베리파이: 센서 데이터 수집 및 처리
- 윈도우: 데이터 시각화 및 분석
- 웹: 플라스크 웹서버를 통한 데이터 제공

## GPIO 핀 배치

| 센서/모듈       | GPIO 핀 번호 |
|----------------|--------------|
| 조도센서       | 17           |
| 초음파센서 Trig | 23           |
| 초음파센서 Echo | 24           |
| 온습도센서     | 4            |
| 전면 LED       | 22           |
| 후면 LED       | 5            |
| 버튼           | 27           |

## 설치 및 실행 방법

### 라즈베리파이 설정

1. **필요한 라이브러리 설치**
   ```bash
   sudo apt-get update
   sudo apt-get install python3-pip
   pip3 install RPi.GPIO Adafruit_DHT paho-mqtt picamera opencv-python-headless scikit-learn
   ```

2. **센서 및 카메라 모듈 연결**
   - 라즈베리파이에 조도센서, 초음파센서, 온습도센서, 카메라 모듈, LED, 버튼을 연결합니다.

3. **`RaspiMain.py` 실행하여 데이터 수집 시작**
   ```bash
   python3 RaspiMain.py
   ```

### 윈도우 설정

1. **MQTT 클라이언트 설치**
   - MQTT 클라이언트를 설치하고, `app.py`에서 설정한 MQTT 브로커 주소를 사용하여 연결합니다.

2. **데이터 시각화 및 분석 프로그램 실행**
   - 플라스크 웹서버를 실행하여 통계 및 운동 기록을 확인합니다.

### 웹 서버 설정

1. **플라스크 설치**
   ```bash
   pip install flask
   ```

2. **웹 서버 실행하여 통계 및 운동 기록 확인**
   ```bash
   python app.py
   ```

## 사용 예시

1. 자전거를 타고 터널에 들어가면 조도센서가 이를 감지하여 경고를 제공합니다.
2. 자전거 전용도로를 벗어나면 카메라가 이를 감지하여 경고를 제공합니다.
3. 비가 올 것 같으면 온습도센서가 이를 감지하여 LED로 경고를 제공합니다.
4. 운동 중 마주친 자전거 수를 카메라가 기록합니다.
5. 버튼을 눌러 휴식 모드로 전환할 수 있습니다.
6. 플라스크 웹서버를 통해 운동 기록 및 통계를 확인할 수 있습니다.
